{% extends 'base.html' %}
{% block title %}Time Sheet{% endblock %}
{% block content %}

<div class="container mt-4">
    <!-- Projects List -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Projects</h3>
        </div>
        <div class="card-body">
            <button class="btn btn-secondary" onclick="openTimeSheetModal('Python_Training_on_bench')">Python_Training_on_bench</button>
            <button class="btn btn-secondary" onclick="openTimeSheetModal('Bench')">Bench</button>
            <button class="btn btn-secondary" onclick="openCustomProjectModal()">Other Project</button> <!-- New button for custom project -->
        </div>
    </div>

    <!-- Time Sheet List -->
    <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
            <h3 class="mb-0">Time Sheet List</h3>
        </div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Project Name</th>
                        <th>Hours</th>
                        <th>Log Date</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Action</th>
                        <th>Manager Comment</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ts in timesheet %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ ts.project }}</td>
                        <td>{{ ts.hours }}h {{ ts.minutes }}m</td>
                        <td>{{ ts.date }}</td>
                        <td>{{ ts.description }}</td>
                        <td class="status {{ ts.status }}">{{ ts.status }}</td>
                        <td>{{ ts.comment|default:"No comments" }}</td>
                        <td>
                            {% if ts.comment %}
                                <span class="text-success">{{ ts.comment }}</span>
                            {% else %}
                                <span class="text-muted">No comments</span>
                            {% endif %}
                        </td>
                        <td>
                            <!-- Edit Button opens the modal with prefilled data -->
                            <button class="btn btn-primary btn-sm" 
                                    onclick="openEditTimeSheetModal('{{ ts.id }}', '{{ ts.project }}', '{{ ts.date }}', '{{ ts.hours }}', '{{ ts.minutes }}', '{{ ts.description }}','{{ ts.comment }}')">
                                Edit
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">No time sheets found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    
<!-- Modal for Adding Time Sheet -->
<div class="modal" id="timeSheetModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Time Sheet for <span id="projectName"></span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeTimeSheetModal()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="POST">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" id="projectInput" name="project">
                    <div class="form-group">
                        <label for="id_date">Date</label>
                        {{ form.date }}
                    </div>
                    <div class="form-group">
                        <label for="id_hours">Hours</label>
                        {{ form.hours }}
                    </div>
                    <div class="form-group">
                        <label for="id_minutes">Minutes</label>
                        {{ form.minutes }}
                    </div>
                    <div class="form-group">
                        <label for="id_description">Description</label>
                        {{ form.description }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeTimeSheetModal()">Close</button>
                    <button type="submit" class="btn btn-primary">Save Time Sheet</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Modal for Custom Project -->
<div class="modal" id="customProjectModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Enter Custom Project Name</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeCustomProjectModal()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="POST" action="#">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="form-group">
                        <label for="custom_project_name">Project Name</label>
                        <input type="text" class="form-control" id="custom_project_name" name="custom_project_name" required>
                    </div>
                    <div class="form-group">
                        <label for="id_date">Date</label>
                        {{ form.date }}
                    </div>
                    <div class="form-group">
                        <label for="id_hours">Hours</label>
                        {{ form.hours }}
                    </div>
                    <div class="form-group">
                        <label for="id_minutes">Minutes</label>
                        {{ form.minutes }}
                    </div>
                    <div class="form-group">
                        <label for="id_description">Description</label>
                        {{ form.description }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCustomProjectModal()">Close</button>
                    <button type="submit" class="btn btn-primary">Save Time Sheet</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Edit Modal -->
<div id="editTimeSheetModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; margin: auto;">
        <form method="post" action="{% url 'edit_time_sheet' %}">
            {% csrf_token %}
            <input type="hidden" name="time_sheet_id" id="edit_time_sheet_id">  <!-- Hidden field for timesheet ID -->

            <!-- Project field -->
            <div class="form-group">
                <label for="editProject">Project</label>
                <input type="text" name="project" id="editProject" class="form-control">
            </div>

            <!-- Date field -->
            <div class="form-group">
                <label for="editDate">Date</label>
                <input type="date" name="date" id="editDate" class="form-control">
            </div>

            <!-- Hours field -->
            <div class="form-group">
                <label for="editHours">Hours</label>
                <input type="number" name="hours" id="editHours" class="form-control">
            </div>

            <!-- Minutes field -->
            <div class="form-group">
                <label for="editMinutes">Minutes</label>
                <input type="number" name="minutes" id="editMinutes" class="form-control">
            </div>

            <!-- Description field -->
            <div class="form-group">
                <label for="editDescription">Description</label>
                <textarea name="description" id="editDescription" class="form-control" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label for="editComment">Manager Comment</label>
                <textarea name="comment" id="editComment" class="form-control" rows="4"></textarea>
            </div>

            <!-- Acknowledgment checkbox for employee -->
            <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" name="acknowledgment" id="acknowledgment">
                <label class="form-check-label" for="acknowledgment">Acknowledge Comment</label>
            </div>


            <!-- Submit button -->
            <button type="submit" class="btn btn-success btn-block">Save</button>
        </form>
    </div>
</div>


<script>
    function openEditTimeSheetModal(id, project, date, hours, minutes, description,comment) {
    document.getElementById('edit_time_sheet_id').value = id;
    document.getElementById('editProject').value = project;
    document.getElementById('editDate').value = date;
    document.getElementById('editHours').value = hours;
    document.getElementById('editMinutes').value = minutes;
    document.getElementById('editDescription').value = description;
    document.getElementById('editComment').value = comment;
    document.getElementById('editTimeSheetModal').style.display = 'block';
}

    function closeEditTimeSheetModal() {
        document.getElementById('editTimeSheetModal').style.display = 'none';
    }
</script>


<script>
    // Open the modal and set the project name
    function openTimeSheetModal(projectName) {
        document.getElementById('timeSheetModal').style.display = 'block';
        document.getElementById('projectName').textContent = projectName;
        document.getElementById('projectInput').value = projectName;
    }

    // Open the modal for entering custom project
    function openCustomProjectModal() {
        document.getElementById('customProjectModal').style.display = 'block';
    }

    function closeCustomProjectModal() {
        document.getElementById('customProjectModal').style.display = 'none';
    }

    // Close the main Time Sheet modal
    function closeTimeSheetModal() {
        document.getElementById('timeSheetModal').style.display = 'none';
    }
</script>

<style>
    /* Modal background */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
    display: none; /* Hide the modal by default */
    z-index: 9999;
    padding-top: 100px;
    padding-left: 15px;
}
.mt-4, .my-4 {
    margin-top: 8.5rem !important;
}

/* Modal content box */
.modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    max-width: 600px;
    margin: auto;
}

/* Form inputs and text areas */
.form-group input, .form-group textarea {
    width: 100%;
    margin-bottom: 10px;
}

/* Submit button */
.btn-block {
    width: 100%;
}

/* Responsive design */
@media (max-width: 768px) {
    .modal-content {
        width: 90%; /* For smaller screens, use 90% of the screen width */
    }
}

</style>

{% endblock %}


